<div class="container">

  <div class="banner-index mt-5" style="background-image: linear-gradient(rgba(0,0,0,0.4),rgba(0,0,0,0.4)), url(https://www.univers-vacances.fr/wp-content/uploads/2020/07/pierre-et-vacances-ete-piscine-image-principale.jpg);">
    <div class="container">
      <h1>Jetez vous à l'eau, devenez propriétaire !</h1>
    </div>
  </div>

  <div class="search-form form-inline mt-5 mb-5">
    <%= simple_form_for :search, url: properties_path, method: "GET", defaults: { required: false }, html: { class: 'form-inline' } do |f| %>
        <% if params["search"] %>
          <%= f.input :nbr_room, label: "Chambres", collection: 1..10, include_blank: true, input_html: {value: ""}, selected: params["search"]["nbr_room"] %>
          <%= f.input :budget, collection: ["1 € - 100 000 €", "100_001 € - 200_000 €" , "200_001 € - 500_000 €" ], include_blank: true, input_html: {value: ""}, selected: params["search"]["budget"]%>
          <%= f.input :region, label: "Région", collection: ["Auvergne-Rhône-Alpes", "Bourgogne-Franche-Comté", "Bretagne", "Centre-Val de Loire", "Corse", "Grand Est", "Hauts-de-France", "Ile-de-France", "Normandie", "Nouvelle-Aquitaine", "Occitanie", "Pays de la Loire", "Provence-Alpes-Côte d’Azur" ], include_blank: true, input_html: {value: ""}, selected: params["search"]["region"]%>
          <%= f.input :home_size, label: "Superficie", collection: ["1 m2 - 50 m2", "51 m2 - 100 m2" , "101 m2 - 200 m2" ], include_blank: true, input_html: {value: ""}, selected: params["search"]["home_size"]%>
        <% else %>
          <%= f.input :nbr_room, collection: 1..10, include_blank: true, input_html: {value: ""}%>
          <%= f.input :budget, collection: ["1 € - 100 000 €", "100_001 € - 200_000 €" , "200_001 € - 500_000 €" ], include_blank: true,input_html: {value: ""}%>
          <%= f.input :region, label: "Région", collection: ["Auvergne-Rhône-Alpes", "Bourgogne-Franche-Comté", "Bretagne", "Centre-Val de Loire", "Corse", "Grand Est", "Hauts-de-France", "Ile-de-France", "Normandie", "Nouvelle-Aquitaine", "Occitanie", "Pays de la Loire", "Provence-Alpes-Côte d’Azur" ], include_blank: true,input_html: {value: ""}%>
           <%= f.input :home_size, label: "Superficie", collection: ["1 m2 - 50 m2", "51 m2 - 100 m2" , "101 m2 - 200 m2" ], include_blank: true, input_html: {value: ""}%>
        <% end %>

        <%= f.submit "Rechercher", class: "btn btn-primary btn-rechercher" %>

    <% end %>
  </div>

  <div class="mapbox-index" style="width: 80%; height: 400px"
    data-controller="mapbox"
    data-mapbox-markers-value="<%= @markers.to_json %>"
    data-mapbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>

  <div class="col-sm-12">
    <div class="property-cards mt-5">
      <% @properties.each_with_index do |property, index| %>
        <div class="card property-card">
          <div class="property-card-image">
            <h2 class="property-card_parts">Part : <%= property.price_part.to_s.gsub(/(?<=\d)(?=(?:\d{3})+\z)/, ' ') %> €</h2>
            <div id='<%="carouselExampleControls#{index}"%>' class="carousel slide" data-interval="false" data-ride="carousel">
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <%= cl_image_tag property.photos.first.key, class: "d-block w-100", alt: "Photo 1" %>
                </div>
                <% property.photos.each_with_index do |photo, index| %>
                  <% if index > 0 %>
                    <div class="carousel-item">
                      <%= cl_image_tag photo.key, class: "d-block w-100", alt: "Photo #{index}" %>
                    </div>
                  <% end %>
                <% end %>
              </div>
              <a class="carousel-control-prev" href='<%="#carouselExampleControls#{index}"%>' role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
              </a>
              <a class="carousel-control-next" href='<%="#carouselExampleControls#{index}"%>' role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
              </a>
            </div>
          </div>
          <div class="property-card-body">
            <h5 class="property-card-title"><%= property.title %></h5>
            <p class="property-card-text">
              <ul style="list-style: none; margin-left: 8px">
                <li> <strong>Ville</strong> : <%= property.address.split(",").second %></li>
                <li> <strong>Surface</strong> : <%= property.home_size %> m2</li>
                <li> <strong>Chambres</strong> : <%= property.nbr_room %></li>
                <li> <strong>Description</strong> : <%= property.detail %></li>
              </ul>
            </p>
            <% if user_signed_in? %>
              <%= link_to "Découvrir", property_path(property.id), class: "btn btn-primary btn-decouvrir" %>
            <% else %>
              <button type="button" class="btn btn-primary btn-decouvrir" data-bs-toggle="modal" data-bs-target="#signupModal">
                Découvrir
              </button>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
    </div>

</div>
<!-- Modal -->
            <div class="modal fade" id="signupModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Connectez vous pour en voir plus !</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <%= simple_form_for(resource, as: resource_name, url: session_path(resource_name)) do |f| %>
                      <div class="form-inputs">
                        <%= f.input :email,
                                    required: false,
                                    autofocus: true,
                                    input_html: { autocomplete: "email" } %>
                        <%= f.input :password,
                                    required: false,
                                    input_html: { autocomplete: "current-password" } %>
                        <%= f.input :remember_me, as: :boolean if devise_mapping.rememberable? %>
                      </div>

                      <div class="form-actions">
                        <%= f.button :submit, "Log in", class: "btn btn-primary" %>
                      </div>
                    <% end %>
                    <%= render "devise/shared/links" %>
                  </div>
                </div>
              </div>
            </div>
