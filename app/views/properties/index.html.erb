<div class="container">

  <div class="banner-index" style="background-image: linear-gradient(rgba(0,0,0,0.4),rgba(0,0,0,0.4)), url(https://www.univers-vacances.fr/wp-content/uploads/2020/07/pierre-et-vacances-ete-piscine-image-principale.jpg);">
    <div class="container">
      <h1>Jetez vous à l'eau, devenez propriétaire !</h1>
    </div>
  </div>

  <div class="search">
    <%= simple_form_for :search, url: properties_path, method: "GET", html: { class: 'form-inline' } do |f| %>
        <% if params["search"] %>
          <%= f.input :nbr_room, collection: 1..10, include_blank: true, input_html: {value: ""}, selected: params["search"]["nbr_room"] %>
          <%= f.input :budget, collection: ["100_000 € - 200_000 €" , "200_001 € - 500_000 €" ], include_blank: true,input_html: {value: ""}, selected: params["search"]["budget"]%>
        <% else %>
          <%= f.input :nbr_room, collection: 1..10, include_blank: true, input_html: {value: ""}%>
          <%= f.input :budget, collection: ["100_000 € - 200_000 €" , "200_001 € - 500_000 €" ], include_blank: true,input_html: {value: ""}%>

        <% end %>

        <%= f.submit "Search", class: "btn btn-primary" %>

    <% end %>
  </div>

  <div class="mapbox-index" style="width: 80%; height: 400px"
    data-controller="mapbox"
    data-mapbox-markers-value="<%= @markers.to_json %>"
    data-mapbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>

  <div class="col-sm-12">
    <div class="property-cards mt-5">
      <% @properties.each_with_index do |property, index| %>
        <div class="card property-card">
          <div class="card-image">
            <h2 class="card_parts">Part : <%= property.price_part.to_s.gsub(/(?<=\d)(?=(?:\d{3})+\z)/, ' ') %> €</h2>
            <div id='<%="carouselExampleControls#{index}"%>' class="carousel slide" data-interval="false" data-ride="carousel">
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <%= cl_image_tag property.photos.first.key, class: "d-block w-100", alt: "Photo 1" %>
                </div>
                <% property.photos.each_with_index do |photo, index| %>
                  <% if index > 0 %>
                    <div class="carousel-item">
                      <%= cl_image_tag photo.key, class: "d-block w-100", alt: "Photo #{index}" %>
                    </div>
                  <% end %>
                <% end %>
              </div>
              <a class="carousel-control-prev" href='<%="#carouselExampleControls#{index}"%>' role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
              </a>
              <a class="carousel-control-next" href='<%="#carouselExampleControls#{index}"%>' role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
              </a>
            </div>
          </div>
          <div class="card-body">
            <h5 class="card-title"><%= property.title %></h5>
            <p class="card-text">
              <ul style="list-style: none;">
                <li> <strong>Adresse</strong> : <%= property.address %></li>
                <li> <strong>Surface</strong> : <%= property.home_size %> m2</li>
                <li> <strong>Description</strong> : <%= property.detail %></li>
              </ul>
            </p>
            <%= link_to "Découvrir", property_path(property.id), class: "btn btn-primary btn-decouvrir" %>
          </div>
        </div>
      <% end %>
    </div>
    </div>

</div>
